{% extends 'base.html' %}
{% block title %}Analytics - Multi-Tenant SaaS{% endblock %}
{% block content %}
<div class="container-fluid py-4">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <div>
      <h2 class="h4 mb-0"><i class="bi bi-graph-up-arrow me-2"></i>Analytics</h2>
      <div class="text-muted small">Current month performance</div>
    </div>
  </div>

  <div class="row g-3 mb-3">
    <div class="col-md-3">
      <div class="card border-0 shadow-sm h-100"><div class="card-body">
        <div class="small text-muted">Total Users</div>
        <div class="display-6">{{ users_total }}</div>
      </div></div>
    </div>
    <div class="col-md-3">
      <div class="card border-0 shadow-sm h-100"><div class="card-body">
        <div class="small text-muted">New Users (month)</div>
        <div class="display-6">{{ users_new_month }}</div>
      </div></div>
    </div>
    <div class="col-md-3">
      <div class="card border-0 shadow-sm h-100"><div class="card-body">
        <div class="small text-muted">Active Subscriptions</div>
        <div class="display-6">{{ active_subscriptions }}</div>
      </div></div>
    </div>
    <div class="col-md-3">
      <div class="card border-0 shadow-sm h-100"><div class="card-body">
        <div class="small text-muted">Revenue (month)</div>
        <div class="display-6">${{ revenue_month }}</div>
      </div></div>
    </div>
  </div>

  <div class="row g-3">
    <div class="col-lg-6">
      <div class="card border-0 shadow-sm h-100">
        <div class="card-header bg-white border-0 pb-0"><h5 class="card-title mb-0">Revenue by Day</h5></div>
        <div class="card-body">
          <canvas id="revenueChart" height="140"></canvas>
        </div>
      </div>
    </div>
    <div class="col-lg-6">
      <div class="card border-0 shadow-sm h-100">
        <div class="card-header bg-white border-0 pb-0"><h5 class="card-title mb-0">Signups by Day</h5></div>
        <div class="card-body">
          <canvas id="signupsChart" height="140"></canvas>
        </div>
      </div>
    </div>
  </div>
</div>

{% block extra_js %}
{{ revenue_series|json_script:"revenue-data" }}
{{ signups_series|json_script:"signups-data" }}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  const revenueData = JSON.parse(document.getElementById('revenue-data').textContent);
  const signupsData = JSON.parse(document.getElementById('signups-data').textContent);
  const revenueLabels = revenueData.map(p => p.day);
  const revenueValues = revenueData.map(p => p.total);
  const signupLabels = signupsData.map(p => p.day);
  const signupValues = signupsData.map(p => p.count);

  const ctxRev = document.getElementById('revenueChart').getContext('2d');
  new Chart(ctxRev, {
    type: 'line',
    data: {
      labels: revenueLabels,
      datasets: [{
        label: 'Revenue',
        data: revenueValues,
        borderColor: '#4f46e5',
        backgroundColor: 'rgba(79, 70, 229, 0.1)'
      }]
    },
    options: { scales: { y: { beginAtZero: true } } }
  });

  const ctxSig = document.getElementById('signupsChart').getContext('2d');
  new Chart(ctxSig, {
    type: 'bar',
    data: {
      labels: signupLabels,
      datasets: [{
        label: 'Signups',
        data: signupValues,
        backgroundColor: '#10b981'
      }]
    },
    options: { scales: { y: { beginAtZero: true } } }
  });
</script>
{% endblock %}
{% endblock %}


